# Gap List - Coppit 実装における不明点と対応方針

**作成日**: 2025-12-23  
**前提**: P0は確定済み、P1以降はconfig化して実装を止めない

---

## P1（動作に影響するが後回し可）

### P1-1: BOXへの侵入可否
- **不明点**: 相手色のBOXに侵入できるか？
- **A案**: 侵入不可（各BOXは自色専用）
- **B案**: 侵入可能だが捕獲はできない
- **C案**: 侵入も捕獲も可能
- **暫定対応**: A案（侵入不可）
- **設定**: `config.allow_box_invasion = false`
- **実装**: BOXノードへの移動を制限

### P1-2: 中央X交差での衝突
- **不明点**: 中央Xの同じマスに複数の帽子が止まれるか？
- **A案**: 通常マスと同じ（捕獲ルール適用）
- **B案**: 中央Xは全てSAFE（共存可能）
- **暫定対応**: A案（通常マスと同じ）
- **設定**: なし（盤面のSAFE_COLORタグで制御）

### P1-3: BOXから出る際の方向
- **不明点**: BOXから外周に出る際、時計回り/反時計回りを選べるか？
- **A案**: 両方向選択可能
- **B案**: 一方向のみ（画像の矢印方向）
- **暫定対応**: A案（両方向選択可能）
- **設定**: `config.box_exit_bidirectional = true`

### P1-4: スタックの最大高さ
- **不明点**: 1つのスタックに何個まで重ねられるか？
- **A案**: 無制限（理論上24個まで）
- **B案**: 制限あり（例: 6個まで）
- **暫定対応**: A案（無制限）
- **設定**: `config.max_stack_height = null`（nullは無制限）

### P1-5: ターン順の決定
- **不明点**: 最初のターン順はどう決まるか？
- **A案**: 固定（RED → BLUE → GREEN → YELLOW）
- **B案**: ランダム
- **C案**: 全員サイコロ振って最大値から
- **暫定対応**: A案（固定）
- **設定**: `config.turn_order_method = "fixed"`

### P1-6: 同一マスでの複数スタック
- **不明点**: SAFEマスで複数スタックが共存した場合、どう表示するか？
- **A案**: 別スタックとして並べる（UI層の問題）
- **B案**: 強制統合
- **暫定対応**: A案（別スタックとして保持）
- **設定**: なし（実装固定）

---

## P2（運用・UI・拡張）

### P2-1: リプレイ機能
- **不明点**: ゲーム終了後、リプレイを見られるようにするか？
- **対応**: ActionLog を保存し、リプレイ機能を実装
- **優先度**: 中

### P2-2: 観戦モード
- **不明点**: プレイヤー以外が観戦できるか？
- **対応**: WebSocketで観戦者専用接続を許可
- **優先度**: 低

### P2-3: チャット機能
- **対応**: WebSocketでチャットメッセージを追加
- **優先度**: 低

### P2-4: UI回転
- **不明点**: 各プレイヤーから見て自分が手前になるよう回転するか？
- **対応**: フロントエンドで座標変換
- **優先度**: 中

### P2-5: アニメーション速度
- **対応**: クライアント設定で調整可能に
- **優先度**: 低

### P2-6: Bot難易度
- **不明点**: Bot の思考レベルをどこまで作り込むか？
- **対応**: 
  - Level 1: ランダム
  - Level 2: ヒューリスティック（捕獲優先）
  - Level 3: AI（将来実装）
- **設定**: `config.bot_difficulty = "heuristic"`
- **優先度**: 中

### P2-7: 2-6人対応
- **対応**: 盤面JSON を追加で作成
- **優先度**: 低（まず4人を完成させる）

### P2-8: カード要素
- **対応**: 拡張ルールとして別途実装
- **優先度**: 最低

---

## P3（実装詳細・最適化）

### P3-1: Redis Pub/Sub
- **対応**: マルチインスタンス対応のため実装
- **優先度**: 中（Renderスケール時に必要）

### P3-2: データベース永続化
- **対応**: Postgres でユーザー・戦績・リプレイログを保存
- **優先度**: 低（まずインメモリで動作確認）

### P3-3: 認証・ログイン
- **対応**: 匿名プレイから開始、後で JWT 等を追加
- **優先度**: 最低

---

## 決定事項まとめ（実装に採用）

| 項目 | 採用案 | Config | デフォルト値 |
|------|--------|--------|--------------|
| BOX侵入 | 不可 | allow_box_invasion | false |
| 中央X捕獲 | 通常通り | - | - |
| BOX出口方向 | 両方向 | box_exit_bidirectional | true |
| スタック高さ | 無制限 | max_stack_height | null |
| ターン順 | 固定 | turn_order_method | "fixed" |
| 複数スタック | 別保持 | - | - |

---

**END OF GAP LIST**
